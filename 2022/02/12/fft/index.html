<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="TOUCH FISH" href="http://bgdvroom.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="TOUCH FISH" href="http://bgdvroom.top/atom.xml"><link rel="alternate" type="application/json" title="TOUCH FISH" href="http://bgdvroom.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="经验分享,STM32"><link rel="canonical" href="http://bgdvroom.top/2022/02/12/fft/"><title>浅谈STM32中的FFT - 嵌入式 | TOUCH FISH = TOUCH FISH = BLOG</title><meta name="generator" content="Hexo 6.0.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">浅谈STM32中的FFT</h1><div class="meta"><span class="item" title="创建时间：2022-02-12 21:08:26"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-02-12T21:08:26+08:00">2022-02-12</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">TOUCH FISH</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipetlbztpj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclga70tsj20zk0m84mr.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciusoyjnj219g0u0x56.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclgrvbd6j20zk0m8qv5.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclfb3vzhj20zk0m8wny.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="item" rel="index" title="分类于 嵌入式"><span itemprop="name">嵌入式</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://bgdvroom.top/2022/02/12/fft/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/mine.png"><meta itemprop="name" content="BGD"><meta itemprop="description" content="BLOG, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="TOUCH FISH"></span><div class="body md" itemprop="articleBody"><h2 id="目录"><a class="anchor" href="#目录">#</a> 目录</h2><ol><li>离散傅里叶变换</li><li>快速傅里叶变换</li><li>fft 在单片机中的应用</li><li>频谱泄露问题</li></ol><h2 id="一-离散傅里叶变换"><a class="anchor" href="#一-离散傅里叶变换">#</a> 一、离散傅里叶变换</h2><p>傅里叶变换的目的就是将信号转换成无数个不同频率的正弦波叠加，然后揭示这些正弦信号的强度和频率的的关系。这意味着任何信号都可以看成无数个正弦波叠加，</p><p><img data-src="/images/pasted-8.png" alt="upload successful"><br>当我们对一个信号进行离散傅里叶变换，就能得到 n 个正弦波不同频率的分量相叠加的一个函数，这是构成频域的一个最基本的条件，要使用傅里叶变换我们必须要能用一个最基本的单元也就是一个数据去表示一个正弦波分量，而这个基本单元就是复数，由于水平有限，在这里不阐述证明方法和过程。</p><p><img data-src="/images/pasted-9.png" alt="upload successful"><br>要理解这个复数要从正弦波的原理说起，正弦波就是一个圆周运动在一条直线上的投影。那么就可以用虚数来表示一个不同频率、相位、幅度的正弦波。</p><p><img data-src="/images/pasted-10.png" alt="upload successful"> <img data-src="/images/pasted-11.png" alt="upload successful"><br>在离散的傅里叶变换中，一个个的虚数就构成了信号的频域，而从图中我们也可以看出我们可以得到很多重要的信息，如幅度、相位。<br><img data-src="/images/pasted-12.png" alt="upload successful"><br>要理解 FFT，了解离散傅里叶变换的过程是很有必要的，我们以 Fs 的采样频率对被测信号进行 N 个点的采样，得到一个 N 点长的数据，然后对数据进行周期延拓，再对数据进行傅里叶变换，得到以复数形式表示的数据。</p><h2 id="二-快速傅里叶变换"><a class="anchor" href="#二-快速傅里叶变换">#</a> 二、快速傅里叶变换</h2><p>DFT 最早是用来分析热过程，并不是用于信号领域，同时它的计算量也非常大，不能满足处理信号的效率要求，而随着计算机领域的发展，一种 DFT 的快速算法被发现也就是 FFT，FFT 才被广泛使用。</p><p>由这种方法计算 DFT 对于 X（K）的每个 K 值，需要进行 4N 次实数相乘和（4N-2）次相加，对于 N 个 k 值，共需 N<em>N 乘和 N（4N-2）次实数相加。改进 DFT 算法，减小它的运算量，利用 DFT 中 的周期性和对称性，使整个 DFT 的计算变成一系列迭代运算，从而能够将运算量从 N^2 减少到 N</em>log2 (N), 其中 N 为待计算的序列的长度。当 N 非常大的时候，这种优化在时间维度上的提升是非常显著的，这就是 FFT 的基本思想。</p><h2 id="三-fft在单片机中的应用"><a class="anchor" href="#三-fft在单片机中的应用">#</a> 三、FFT 在单片机中的应用</h2><p>从傅里叶级数的公式中我们可以得到 Fn 就是频谱中的最小频率分辨率</p><p><img data-src="/images/pasted-13.png" alt="upload successful"><br>FFT 的本质就是 DFT，而我们要得到的结果也包括频域，因此我们同样要避免 DFT 中出现频谱混叠的问题，根据采样定理，只有当采样频率大于信号最高频率的两倍时，才能避免频域混叠。因此采样深度和频率精度要做到取舍，当当采样频率越高，根据公式，频率分辨率就会降低，但增加了采样深度；频率精度则相反。</p><p>在单片机中我们要进行 FFT 需要用到 DSP 库中的函数</p><pre><code>	void arm_rfft_fast_f32(arm_rfft_fast_instance_f32 *s,float *pIn,float *pOut,u8 ifftflag);
    //s是配置FFT参数的结构体
    //pIn是N点长的采样数组
    //pOut是N点长的以高16位储存实数、低16位储存虚数为格式的数组，也是傅里叶变换的结果
    //ifftflag是控制傅里叶正变换、逆变换的参数
</code></pre><p>进行 FFT</p><pre><code>  #define FFT_SIZE 1024;
  float FFT_IN[FFT_SIZE],FFT_OUT[FFT_SIZE],Mag[FFT_SIZE];
  arm_rfft_fast_instance_f32 FFT;//声明结构体
  arm_rfft_fast_init_f32(&amp;FFT,FFT_SIZE);//初始化该结构体
  arm_rfft_fast_f32(&amp;FFT,FFT_IN, FFT_OUT, 0);//ifft_flag=0是正变换， 为1则是逆变换
  arm_cmplx_mag_f32(FFT_OUT, Mag, FFT_SIZE); //再对复数结果求模
</code></pre><ul><li>FFT_SIZE 和采样速率最好是 4 的 n 次幂，因为 DSP 库中的 FFT 是基 4 的，如果不是则会出现频谱泄露。</li><li>FFT_OUT 中数据是以高 16 位储存实数、低 16 位储存虚数为格式的数组，通过 DFT 的定义我们可以从中得到相位、幅度信息</li></ul><h2 id="四-频谱泄露问题"><a class="anchor" href="#四-频谱泄露问题">#</a> 四、频谱泄露问题</h2><ol><li><h5 id="频谱泄露是什么"><a class="anchor" href="#频谱泄露是什么">#</a> 频谱泄露是什么</h5></li></ol><p>在 FFT 的使用过程中，我们经常会碰到的一个问题就是频谱泄漏，明明没有这个频率的分量，但 FFT 过后频谱中却出现了这个频率的分量，这同样也是 DFT 会出现的问题。</p><p>这是因为在 FFT 的过程中，我们将采样信号进行了周期延拓，使用有有限长的序列来代表无限长的序列，再进行傅里叶变换，当采样得到得结果不是整周期，就会出现截断效应</p><p><img data-src="/images/pasted-14.png" alt="upload successful"></p><p><img data-src="/images/pasted-15.png" alt="upload successful"><br>图 2 的信号与图 1 的信号不同，分析得到的频谱自然也不同，不同之处在于，图 1 是单一频率信号，只有一根谱线，而图 2 中，除了图 1 信号包含的这根谱线（不妨称为主谱线）外，出现了其它频率的谱线，通常，这些谱线要比主谱线短很多，如果把这些原信号不包含的谱线理解为是主谱线泄露出来的，那么，这种现象就被称为频谱泄露。</p><ul><li><h5 id="解决频谱泄露"><a class="anchor" href="#解决频谱泄露">#</a> 解决频谱泄露</h5></li></ul><p>要解决频谱泄露，最根本的办法就是整周期截断，以 4 的幂次方的采样频率进行采样，而对于无法达到采样频率要求的情况下，我们可以使用窗函数的办法。<br>采用合适的窗函数（常见的窗函数有汉宁窗、三角窗、海明窗和高斯窗等等）可以一定程度上抑制频谱泄露。这种办法简单来说就是使用加权的函数将截断部分进行圆滑处理，但同时也污染了原信号，会产生幅度相位等信息的改变。</p><ul><li><h5 id="窗函数的解决办法"><a class="anchor" href="#窗函数的解决办法">#</a> 窗函数的解决办法</h5><pre><code>  float hanning_window[1024] = &#123;
0.0f,0.0000f,0.0000f,0.0001f,0.0002f,0.0002f,0.0003f,0.0005f,0.0006f,0.0008f,0.0009f,0.0011f,0.0014f,0.0016f,0.0018f,0.0021f,0.0024f,0.0027f,0.0030f,0.0034f,0.0038f,0.0041f,0.0045f,0.0050f,0.0054f,0.0059f,0.0063f,0.0068f,0.0074f,0.0079f,0.0084f,0.0090f,0.0096f,0.0102f,0.0108f,0.0115f,0.0121f,0.0128f,0.0135f,0.0142f,0.0150f,0.0157f,0.0165f,0.0173f,0.0181f,0.0189f,0.0198f,0.0206f,0.0215f,0.0224f,0.0233f,0.0243f,0.0252f,0.0262f,0.0272f,0.0282f,0.0292f,0.0303f,0.0313f,0.0324f,0.0335f,0.0346f,0.0357f,0.0369f,0.0381f,0.0392f,0.0404f,0.0417f,0.0429f,0.0441f,0.0454f,0.0467f,0.0480f,0.0493f,0.0507f,0.0520f,0.0534f,0.0548f,0.0562f,0.0576f,0.0590f,0.0605f,0.0620f,0.0635f,0.0650f,0.0665f,0.0680f,0.0696f,0.0711f,0.0727f,0.0743f,0.0759f,0.0776f,0.0792f,0.0809f,0.0826f,0.0843f,0.0860f,0.0877f,0.0894f,0.0912f,0.0930f,0.0948f,0.0966f,0.0984f,0.1002f,0.1021f,0.1039f,0.1058f,0.1077f,0.1096f,0.1116f,0.1135f,0.1154f,0.1174f,0.1194f,0.1214f,0.1234f,0.1254f,0.1275f,0.1295f,0.1316f,0.1337f,0.1358f,0.1379f,0.1400f,0.1421f,0.1443f,0.1464f,0.1486f,0.1508f,0.1530f,0.1552f,0.1575f,0.1597f,0.1620f,0.1642f,0.1665f,0.1688f,0.1711f,0.1734f,0.1757f,0.1781f,0.1804f,0.1828f,0.1852f,0.1876f,0.1900f,0.1924f,0.1948f,0.1972f,0.1997f,0.2022f,0.2046f,0.2071f,0.2096f,0.2121f,0.2146f,0.2171f,0.2197f,0.2222f,0.2248f,0.2273f,0.2299f,0.2325f,0.2351f,0.2377f,0.2403f,0.2429f,0.2456f,0.2482f,0.2509f,0.2536f,0.2562f,0.2589f,0.2616f,0.2643f,0.2670f,0.2697f,0.2725f,0.2752f,0.2779f,0.2807f,0.2835f,0.2862f,0.2890f,0.2918f,0.2946f,0.2974f,0.3002f,0.3030f,0.3058f,0.3087f,0.3115f,0.3143f,0.3172f,0.3201f,0.3229f,0.3258f,0.3287f,0.3316f,0.3344f,0.3373f,0.3402f,0.3432f,0.3461f,0.3490f,0.3519f,0.3549f,0.3578f,0.3607f,0.3637f,0.3666f,0.3696f,0.3726f,0.3755f,0.3785f,0.3815f,0.3845f,0.3875f,0.3904f,0.3934f,0.3964f,0.3994f,0.4025f,0.4055f,0.4085f,0.4115f,0.4145f,0.4175f,0.4206f,0.4236f,0.4266f,0.4297f,0.4327f,0.4358f,0.4388f,0.4418f,0.4449f,0.4479f,0.4510f,0.4540f,0.4571f,0.4602f,0.4632f,0.4663f,0.4693f,0.4724f,0.4755f,0.4785f,0.4816f,0.4847f,0.4877f,0.4908f,0.4939f,0.4969f,0.5000f,0.5031f,0.5061f,0.5092f,0.5123f,0.5153f,0.5184f,0.5215f,0.5245f,0.5276f,0.5307f,0.5337f,0.5368f,0.5398f,0.5429f,0.5460f,0.5490f,0.5521f,0.5551f,0.5582f,0.5612f,0.5642f,0.5673f,0.5703f,0.5734f,0.5764f,0.5794f,0.5825f,0.5855f,0.5885f,0.5915f,0.5945f,0.5975f,0.6006f,0.6036f,0.6066f,0.6096f,0.6125f,0.6155f,0.6185f,0.6215f,0.6245f,0.6274f,0.6304f,0.6334f,0.6363f,0.6393f,0.6422f,0.6451f,0.6481f,0.6510f,0.6539f,0.6568f,0.6598f,0.6627f,0.6656f,0.6684f,0.6713f,0.6742f,0.6771f,0.6799f,0.6828f,0.6857f,0.6885f,0.6913f,0.6942f,0.6970f,0.6998f,0.7026f,0.7054f,0.7082f,0.7110f,0.7138f,0.7165f,0.7193f,0.7221f,0.7248f,0.7275f,0.7303f,0.7330f,0.7357f,0.7384f,0.7411f,0.7438f,0.7464f,0.7491f,0.7518f,0.7544f,0.7571f,0.7597f,0.7623f,0.7649f,0.7675f,0.7701f,0.7727f,0.7752f,0.7778f,0.7803f,0.7829f,0.7854f,0.7879f,0.7904f,0.7929f,0.7954f,0.7978f,0.8003f,0.8028f,0.8052f,0.8076f,0.8100f,0.8124f,0.8148f,0.8172f,0.8196f,0.8219f,0.8243f,0.8266f,0.8289f,0.8312f,0.8335f,0.8358f,0.8380f,0.8403f,0.8425f,0.8448f,0.8470f,0.8492f,0.8514f,0.8536f,0.8557f,0.8579f,0.8600f,0.8621f,0.8642f,0.8663f,0.8684f,0.8705f,0.8725f,0.8746f,0.8766f,0.8786f,0.8806f,0.8826f,0.8846f,0.8865f,0.8884f,0.8904f,0.8923f,0.8942f,0.8961f,0.8979f,0.8998f,0.9016f,0.9034f,0.9052f,0.9070f,0.9088f,0.9106f,0.9123f,0.9140f,0.9157f,0.9174f,0.9191f,0.9208f,0.9224f,0.9241f,0.9257f,0.9273f,0.9289f,0.9304f,0.9320f,0.9335f,0.9350f,0.9365f,0.9380f,0.9395f,0.9410f,0.9424f,0.9438f,0.9452f,0.9466f,0.9480f,0.9493f,0.9507f,0.9520f,0.9533f,0.9546f,0.9559f,0.9571f,0.9583f,0.9596f,0.9608f,0.9619f,0.9631f,0.9643f,0.9654f,0.9665f,0.9676f,0.9687f,0.9697f,0.9708f,0.9718f,0.9728f,0.9738f,0.9748f,0.9757f,0.9767f,0.9776f,0.9785f,0.9794f,0.9802f,0.9811f,0.9819f,0.9827f,0.9835f,0.9843f,0.9850f,0.9858f,0.9865f,0.9872f,0.9879f,0.9885f,0.9892f,0.9898f,0.9904f,0.9910f,0.9916f,0.9921f,0.9926f,0.9932f,0.9937f,0.9941f,0.9946f,0.9950f,0.9955f,0.9959f,0.9962f,0.9966f,0.9970f,0.9973f,0.9976f,0.9979f,0.9982f,0.9984f,0.9986f,0.9989f,0.9991f,0.9992f,0.9994f,0.9995f,0.9997f,0.9998f,0.9998f,0.9999f,1.0000f,1.0000f,1.0000f,1.0000f,1.0000f,0.9999f,0.9998f,0.9998f,0.9997f,0.9995f,0.9994f,0.9992f,0.9991f,0.9989f,0.9986f,0.9984f,0.9982f,0.9979f,0.9976f,0.9973f,0.9970f,0.9966f,0.9962f,0.9959f,0.9955f,0.9950f,0.9946f,0.9941f,0.9937f,0.9932f,0.9926f,0.9921f,0.9916f,0.9910f,0.9904f,0.9898f,0.9892f,0.9885f,0.9879f,0.9872f,0.9865f,0.9858f,0.9850f,0.9843f,0.9835f,0.9827f,0.9819f,0.9811f,0.9802f,0.9794f,0.9785f,0.9776f,0.9767f,0.9757f,0.9748f,0.9738f,0.9728f,0.9718f,0.9708f,0.9697f,0.9687f,0.9676f,0.9665f,0.9654f,0.9643f,0.9631f,0.9619f,0.9608f,0.9596f,0.9583f,0.9571f,0.9559f,0.9546f,0.9533f,0.9520f,0.9507f,0.9493f,0.9480f,0.9466f,0.9452f,0.9438f,0.9424f,0.9410f,0.9395f,0.9380f,0.9365f,0.9350f,0.9335f,0.9320f,0.9304f,0.9289f,0.9273f,0.9257f,0.9241f,0.9224f,0.9208f,0.9191f,0.9174f,0.9157f,0.9140f,0.9123f,0.9106f,0.9088f,0.9070f,0.9052f,0.9034f,0.9016f,0.8998f,0.8979f,0.8961f,0.8942f,0.8923f,0.8904f,0.8884f,0.8865f,0.8846f,0.8826f,0.8806f,0.8786f,0.8766f,0.8746f,0.8725f,0.8705f,0.8684f,0.8663f,0.8642f,0.8621f,0.8600f,0.8579f,0.8557f,0.8536f,0.8514f,0.8492f,0.8470f,0.8448f,0.8425f,0.8403f,0.8380f,0.8358f,0.8335f,0.8312f,0.8289f,0.8266f,0.8243f,0.8219f,0.8196f,0.8172f,0.8148f,0.8124f,0.8100f,0.8076f,0.8052f,0.8028f,0.8003f,0.7978f,0.7954f,0.7929f,0.7904f,0.7879f,0.7854f,0.7829f,0.7803f,0.7778f,0.7752f,0.7727f,0.7701f,0.7675f,0.7649f,0.7623f,0.7597f,0.7571f,0.7544f,0.7518f,0.7491f,0.7464f,0.7438f,0.7411f,0.7384f,0.7357f,0.7330f,0.7303f,0.7275f,0.7248f,0.7221f,0.7193f,0.7165f,0.7138f,0.7110f,0.7082f,0.7054f,0.7026f,0.6998f,0.6970f,0.6942f,0.6913f,0.6885f,0.6857f,0.6828f,0.6799f,0.6771f,0.6742f,0.6713f,0.6684f,0.6656f,0.6627f,0.6598f,0.6568f,0.6539f,0.6510f,0.6481f,0.6451f,0.6422f,0.6393f,0.6363f,0.6334f,0.6304f,0.6274f,0.6245f,0.6215f,0.6185f,0.6155f,0.6125f,0.6096f,0.6066f,0.6036f,0.6006f,0.5975f,0.5945f,0.5915f,0.5885f,0.5855f,0.5825f,0.5794f,0.5764f,0.5734f,0.5703f,0.5673f,0.5642f,0.5612f,0.5582f,0.5551f,0.5521f,0.5490f,0.5460f,0.5429f,0.5398f,0.5368f,0.5337f,0.5307f,0.5276f,0.5245f,0.5215f,0.5184f,0.5153f,0.5123f,0.5092f,0.5061f,0.5031f,0.5000f,0.4969f,0.4939f,0.4908f,0.4877f,0.4847f,0.4816f,0.4785f,0.4755f,0.4724f,0.4693f,0.4663f,0.4632f,0.4602f,0.4571f,0.4540f,0.4510f,0.4479f,0.4449f,0.4418f,0.4388f,0.4358f,0.4327f,0.4297f,0.4266f,0.4236f,0.4206f,0.4175f,0.4145f,0.4115f,0.4085f,0.4055f,0.4025f,0.3994f,0.3964f,0.3934f,0.3904f,0.3875f,0.3845f,0.3815f,0.3785f,0.3755f,0.3726f,0.3696f,0.3666f,0.3637f,0.3607f,0.3578f,0.3549f,0.3519f,0.3490f,0.3461f,0.3432f,0.3402f,0.3373f,0.3344f,0.3316f,0.3287f,0.3258f,0.3229f,0.3201f,0.3172f,0.3143f,0.3115f,0.3087f,0.3058f,0.3030f,0.3002f,0.2974f,0.2946f,0.2918f,0.2890f,0.2862f,0.2835f,0.2807f,0.2779f,0.2752f,0.2725f,0.2697f,0.2670f,0.2643f,0.2616f,0.2589f,0.2562f,0.2536f,0.2509f,0.2482f,0.2456f,0.2429f,0.2403f,0.2377f,0.2351f,0.2325f,0.2299f,0.2273f,0.2248f,0.2222f,0.2197f,0.2171f,0.2146f,0.2121f,0.2096f,0.2071f,0.2046f,0.2022f,0.1997f,0.1972f,0.1948f,0.1924f,0.1900f,0.1876f,0.1852f,0.1828f,0.1804f,0.1781f,0.1757f,0.1734f,0.1711f,0.1688f,0.1665f,0.1642f,0.1620f,0.1597f,0.1575f,0.1552f,0.1530f,0.1508f,0.1486f,0.1464f,0.1443f,0.1421f,0.1400f,0.1379f,0.1358f,0.1337f,0.1316f,0.1295f,0.1275f,0.1254f,0.1234f,0.1214f,0.1194f,0.1174f,0.1154f,0.1135f,0.1116f,0.1096f,0.1077f,0.1058f,0.1039f,0.1021f,0.1002f,0.0984f,0.0966f,0.0948f,0.0930f,0.0912f,0.0894f,0.0877f,0.0860f,0.0843f,0.0826f,0.0809f,0.0792f,0.0776f,0.0759f,0.0743f,0.0727f,0.0711f,0.0696f,0.0680f,0.0665f,0.0650f,0.0635f,0.0620f,0.0605f,0.0590f,0.0576f,0.0562f,0.0548f,0.0534f,0.0520f,0.0507f,0.0493f,0.0480f,0.0467f,0.0454f,0.0441f,0.0429f,0.0417f,0.0404f,0.0392f,0.0381f,0.0369f,0.0357f,0.0346f,0.0335f,0.0324f,0.0313f,0.0303f,0.0292f,0.0282f,0.0272f,0.0262f,0.0252f,0.0243f,0.0233f,0.0224f,0.0215f,0.0206f,0.0198f,0.0189f,0.0181f,0.0173f,0.0165f,0.0157f,0.0150f,0.0142f,0.0135f,0.0128f,0.0121f,0.0115f,0.0108f,0.0102f,0.0096f,0.0090f,0.0084f,0.0079f,0.0074f,0.0068f,0.0063f,0.0059f,0.0054f,0.0050f,0.0045f,0.0041f,0.0038f,0.0034f,0.0030f,0.0027f,0.0024f,0.0021f,0.0018f,0.0016f,0.0014f,0.0011f,0.0009f,0.0008f,0.0006f,0.0005f,0.0003f,0.0002f,0.0002f,0.0001f,0.0000f,0.0000f&#125;;

  arm_mult_f32(FFT_Input,hanning_window,FFT_Input,1024);
  arm_rfft_fast_f32(&amp;FFT,FFT_IN, FFT_OUT, 0);
  arm_cmplx_mag_f32(FFT_OUT, Mag, FFT_SIZE); //再对复数结果求模 
  /*加汉宁窗后，其幅值减为原来的一半，且会在改频率点两旁各引入一个本不存在的点，且这两个点的幅值为中心点幅值的一半。*/
  arm_scale_f32(Mag,2.0,Mag,FFT_SIZE);//矫正幅度
</code></pre></li></ul><div class="tags"><a href="/tags/%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/" rel="tag"><i class="ic i-tag"></i> 经验分享</a> <a href="/tags/STM32/" rel="tag"><i class="ic i-tag"></i> STM32</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-04-07 14:26:08" itemprop="dateModified" datetime="2022-04-07T14:26:08+08:00">2022-04-07</time> </span><span id="2022/02/12/fft/" class="item leancloud_visitors" data-flag-title="浅谈STM32中的FFT" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>BGD <i class="ic i-at"><em>@</em></i>TOUCH FISH</li><li class="link"><strong>本文链接：</strong> <a href="http://bgdvroom.top/2022/02/12/fft/" title="浅谈STM32中的FFT">http://bgdvroom.top/2022/02/12/fft/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/02/10/stm32cubeide-%E6%B7%BB%E5%8A%A0DSP%E5%BA%93/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipexbei4hj20zk0m8npd.jpg" title="stm32cubeide 移植DSP库"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 嵌入式</span><h3>stm32cubeide 移植DSP库</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E7%A6%BB%E6%95%A3%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2"><span class="toc-number">2.</span> <span class="toc-text">一、离散傅里叶变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2"><span class="toc-number">3.</span> <span class="toc-text">二、快速傅里叶变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-fft%E5%9C%A8%E5%8D%95%E7%89%87%E6%9C%BA%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">三、FFT 在单片机中的应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E9%A2%91%E8%B0%B1%E6%B3%84%E9%9C%B2%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">四、频谱泄露问题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%91%E8%B0%B1%E6%B3%84%E9%9C%B2%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">频谱泄露是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%A2%91%E8%B0%B1%E6%B3%84%E9%9C%B2"><span class="toc-number">5.0.0.2.</span> <span class="toc-text">解决频谱泄露</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AA%97%E5%87%BD%E6%95%B0%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-number">5.0.0.3.</span> <span class="toc-text">窗函数的解决办法</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/02/10/stm32cubeide-%E6%B7%BB%E5%8A%A0DSP%E5%BA%93/" rel="bookmark" title="stm32cubeide 移植DSP库">stm32cubeide 移植DSP库</a></li><li class="active"><a href="/2022/02/12/fft/" rel="bookmark" title="浅谈STM32中的FFT">浅谈STM32中的FFT</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="BGD" data-src="/images/mine.png"><p class="name" itemprop="name">BGD</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">5</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">2</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">5</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnlvdXJuYW1lQG1haWwuY29t" title="mailto:yourname@mail.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2022/02/09/hello-world/" title="Hello World">Hello World</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" title="分类于 嵌入式">嵌入式</a></div><span><a href="/2022/02/10/stm32cubeide-%E6%B7%BB%E5%8A%A0DSP%E5%BA%93/" title="stm32cubeide 移植DSP库">stm32cubeide 移植DSP库</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" title="分类于 嵌入式">嵌入式</a></div><span><a href="/2022/02/12/fft/" title="浅谈STM32中的FFT">浅谈STM32中的FFT</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%89%8D%E7%AB%AF/" title="分类于 前端">前端</a></div><span><a href="/2022/02/09/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/" title="我的第一篇博客">我的第一篇博客</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%89%8D%E7%AB%AF/" title="分类于 前端">前端</a></div><span><a href="/2022/02/09/SSH%E8%BF%9E%E6%8E%A5%E5%8F%8Avscode%E4%B8%8A%E5%BB%BA%E7%AB%8B%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E8%BF%9E%E6%8E%A5/" title="SSH连接及vscode上建立与服务器的连接">SSH连接及vscode上建立与服务器的连接</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">BGD @ TOUCH FISH</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/02/12/fft/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>